@model PawHelp.Models.RescueRequest

@{
    ViewData["Title"] = "Chi ti·∫øt y√™u c·∫ßu";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="mb-4">
    <a href="@Url.Action("RescueRequests")" class="btn btn-secondary">‚Üê Quay l·∫°i</a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card card-custom mb-3">
            <div class="card-header">
                <h5 class="mb-0">üìã Th√¥ng tin y√™u c·∫ßu</h5>
            </div>
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-md-4"><strong>M√£ y√™u c·∫ßu:</strong></div>
                    <div class="col-md-8">#@Model.Id</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>Ng∆∞·ªùi b√°o c√°o:</strong></div>
                    <div class="col-md-8">@Model.ReporterName</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong></div>
                    <div class="col-md-8">@Model.PhoneNumber</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>Email:</strong></div>
                    <div class="col-md-8">@(Model.Email ?? "Kh√¥ng c√≥")</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>ƒê·ªãa ƒëi·ªÉm:</strong></div>
                    <div class="col-md-8">@Model.Location</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>Lo·∫°i ƒë·ªông v·∫≠t:</strong></div>
                    <div class="col-md-8">@(Model.AnimalType ?? "Kh√¥ng r√µ")</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4"><strong>Ng√†y b√°o c√°o:</strong></div>
                    <div class="col-md-8">@Model.RequestDate.ToString("dd/MM/yyyy HH:mm")</div>
                </div>
                @if (Model.ResponseDate != null)
                {
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Ng√†y ph·∫£n h·ªìi:</strong></div>
                        <div class="col-md-8">@Model.ResponseDate?.ToString("dd/MM/yyyy HH:mm")</div>
                    </div>
                }
                @if (Model.CompletedDate != null)
                {
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Ng√†y ho√†n th√†nh:</strong></div>
                        <div class="col-md-8">@Model.CompletedDate?.ToString("dd/MM/yyyy HH:mm")</div>
                    </div>
                }
            </div>
        </div>

        <div class="card card-custom mb-3">
            <div class="card-header">
                <h5 class="mb-0">üìù M√¥ t·∫£ t√¨nh hu·ªëng</h5>
            </div>
            <div class="card-body">
                <p>@Model.Description</p>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.AdminNotes))
        {
            <div class="card card-custom mb-3">
                <div class="card-header">
                    <h5 class="mb-0">üìå Ghi ch√∫ c·ªßa Admin</h5>
                </div>
                <div class="card-body">
                    <p>@Model.AdminNotes</p>
                </div>
            </div>
        }
    </div>

    <div class="col-md-4">
        <div class="card card-custom mb-3">
            <div class="card-header">
                <h5 class="mb-0">‚ö° Tr·∫°ng th√°i</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <strong>ƒê·ªô ∆∞u ti√™n:</strong>
                    @{
                        var priorityClass = Model.Priority switch
                        {
                            "Kh·∫©n c·∫•p" => "bg-danger",
                            "Cao" => "bg-warning text-dark",
                            "Trung b√¨nh" => "bg-info",
                            "Th·∫•p" => "bg-secondary",
                            _ => "bg-secondary"
                        };
                    }
                    <br />
                    <span class="badge @priorityClass fs-6 mt-1">@Model.Priority</span>
                </div>
                <div class="mb-3">
                    <strong>Tr·∫°ng th√°i hi·ªán t·∫°i:</strong>
                    @{
                        var statusClass = Model.Status switch
                        {
                            "Ch·ªù x·ª≠ l√Ω" => "bg-warning text-dark",
                            "ƒêang x·ª≠ l√Ω" => "bg-info",
                            "Ho√†n th√†nh" => "bg-success",
                            "H·ªßy b·ªè" => "bg-secondary",
                            _ => "bg-secondary"
                        };
                    }
                    <br />
                    <span class="badge @statusClass fs-6 mt-1">@Model.Status</span>
                </div>
            </div>
        </div>

        <div class="card card-custom mb-3">
            <div class="card-header">
                <h5 class="mb-0">üîÑ C·∫≠p nh·∫≠t tr·∫°ng th√°i</h5>
            </div>
            <div class="card-body">
                <form asp-action="UpdateRequestStatus" method="post">
                    <input type="hidden" name="id" value="@Model.Id" />
                    
                    <div class="mb-3">
                        <label class="form-label">Tr·∫°ng th√°i m·ªõi:</label>
                        <select name="status" class="form-select" required>
                            <option value="Ch·ªù x·ª≠ l√Ω" selected="@(Model.Status == "Ch·ªù x·ª≠ l√Ω")">Ch·ªù x·ª≠ l√Ω</option>
                            <option value="ƒêang x·ª≠ l√Ω" selected="@(Model.Status == "ƒêang x·ª≠ l√Ω")">ƒêang x·ª≠ l√Ω</option>
                            <option value="Ho√†n th√†nh" selected="@(Model.Status == "Ho√†n th√†nh")">Ho√†n th√†nh</option>
                            <option value="H·ªßy b·ªè" selected="@(Model.Status == "H·ªßy b·ªè")">H·ªßy b·ªè</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Ghi ch√∫:</label>
                        <textarea name="adminNotes" class="form-control" rows="3">@Model.AdminNotes</textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">üíæ C·∫≠p nh·∫≠t</button>
                </form>
            </div>
        </div>

        <div class="card card-custom">
            <div class="card-header">
                <h5 class="mb-0">üë§ Ph√¢n c√¥ng</h5>
            </div>
            <div class="card-body">
                <form asp-action="AssignRequest" method="post">
                    <input type="hidden" name="id" value="@Model.Id" />
                    
                    <div class="mb-3">
                        <label class="form-label">Ch·ªçn nh√¢n vi√™n:</label>
                        <select name="userId" class="form-select" required>
                            <option value="">-- Ch·ªçn nh√¢n vi√™n --</option>
                            @foreach (var user in ViewBag.Users)
                            {
                                <option value="@user.Id" selected="@(Model.AssignedToUserId == user.Id)">
                                    @user.FullName (@user.Role)
                                </option>
                            }
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100">‚úÖ Ph√¢n c√¥ng</button>
                </form>
            </div>
        </div>
    </div>
</div>

